<!doctype html>
<html class="no-js" lang="">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>EnerNOC email signature generator</title>
	<meta name="description" content="this github page">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<style>
		body {font: 11px/1.4 arial, sans-serif; color: #333; text-align: center;}
		.container {width: 600px; margin: 40px auto; text-align: left;}
		fieldset {padding: 0; border: 0; margin: 0;}
		fieldset > p {margin: 0;}
		legend {display: none;}
		input {outline: none; box-sizing: border-box;}
		.label {width: 60px; display: inline-block; padding: 0.3em 0; margin-top: 2px;}
		.sig-input {margin-bottom: 5px;	width: auto; padding: 0.3em;}
		.sig-inputs-wrapper {	}
		.sig-preview {}
		.sig-source {padding: 0.3em;}
		h3 {background: #eee; padding: .3em .5em; color: #999; font-weight: normal; margin: 30px 0 5px; font-size: 11px;}
		hr {border: 0; border-top: 1px solid #ddd; margin: 20px 0;}
		textarea {width: 100%; height: 120px; border: 1px solid #ddd; outline: none; box-sizing: border-box;}
		button {margin-top: 20px;}
	</style>
	<script src="//cdnjs.cloudflare.com/ajax/libs/zeroclipboard/2.2.0/ZeroClipboard.min.js"></script>
	<script>
		window.onload = function () {
			var auto = true;
			var preview = document.querySelector('.sig-preview');
			var source = document.querySelector('.sig-source');

			source.onfocus = function () {
				source.select();
			};
			source.onmouseup = function () {
				return false;
			};

			function bind(name, fallback, notify) {
				input[name] = document.querySelector('[name=' + name + ']');
				input[name].onchange = input[name].oninput = function (e) {
					var text = input[name].value;
					if (name === 'email' && e) {
						auto = !text;
					}
					if (!text) {
						text = typeof fallback === 'function' ? fallback() : fallback;
					} else if (name === 'name' && auto) {
						input['email'].value = text.toLowerCase().replace(/ /g, '.') + '@enernoc.com';
						input['email'].oninput();
					}
					if (input[name].type === 'tel') {
						// format phone numbers consistently
						var stripped = text.replace(/[-+.() ]/g, '');
						var match = stripped.match(/^(\+1)?(\d{3})(\d{3})(\d{4})$/);
						if (match) {
							text = ['+1 ', '(' + match[2] + ')', match[3], match[4]].join(' ');
							stripped = ['+1', match[2], match[3], match[4]].join('');
						}
						output[name].href = 'tel:' + encodeURIComponent(text);
						output[name].setAttribute('value', stripped);
					}
					if (input[name].type === 'email') {
						output[name].href = 'sendto:' + text;
					}
					output[name].textContent = text;
					source.textContent = preview.innerHTML.replace(/^\s+/, '').replace(/\n\s+/g, '\n');
					if (notify) {
						input[notify].oninput();
					}
				};
			}
			var input = {};
			var output = {
				name: document.querySelector('.sig-preview div:nth-of-type(1) > strong'),
				title: document.querySelector('.sig-preview div:nth-of-type(1) > span'),
				address: document.querySelector('.sig-preview div:nth-of-type(2)'),
				office: document.querySelector('.sig-preview div:nth-of-type(3) > a:nth-of-type(1)'),
				mobile: document.querySelector('.sig-preview div:nth-of-type(3) > a:nth-of-type(2)'),
				email: document.querySelector('.sig-preview div:nth-of-type(3) > a:nth-of-type(3)')
			};

			bind('name', 'Michael Ellis');
			bind('email', 'michael.ellis@enernoc.com');
			bind('title', 'Widget Supervisor');
			bind('address', null, 'office');
			bind('office', function () {
				return /Vancouver/.test(input['address'].value) ? '+1 (778) 331 0500' : '+1 (617) 224 9900'
			});
			bind('mobile', '+1 (604) 555 0199');

			var button = document.querySelector('#sig-copy-button');
			ZeroClipboard.config({
				forceEnhancedClipboard: true
			});
			ZeroClipboard.on('error', function () {
				button.style.display = 'none';
			});
			var clip = new ZeroClipboard(button);
			clip.on('copy', function (event) {
				var clipboard = event.clipboardData;
				clipboard.setData('text/plain', source.value);
				clipboard.setData('text/html', source.value);
			});

			// handle auto-filled inputs on page reload
			Object.keys(input).forEach(function (key) {
				input[key].oninput();
			});
		};
	</script>
</head>
<body>

<div class="container">

	<fieldset class="sig-inputs-wrapper">
		<legend>Email signature details</legend>
		<p>
			<label for="name">
				<span class="label">Name:</span>
				<input type="text" size="30" class="sig-input" name="name" value="" spellcheck="false" placeholder="Michael Ellis">
			</label>
		</p>
		<p>
			<label for="title">
				<span class="label">Title:</span>
				<input type="text" size="30" class="sig-input" name="title" value="" placeholder="Widget Supervisor">
			</label>
		</p>
		<p>
			<label for="address">
				<span class="label">Address:</span>
				<select class="sig-input" name="address">
					<option>EnerNOC, Inc. / 576 Seymour Street, Suite 600, Vancouver, BC V6B 3K1</option>
					<option>EnerNOC, Inc. / One Marina Park Drive, Suite 400, Boston, MA 02210</option>
				</select>
			</label>
		</p>
		<p>
			<label for="office">
				<span class="label">Office #:</span>
				<input type="tel" size="20" class="sig-input" name="office" value="" maxlength="10" placeholder="7783310500">
			</label>
		</p>
		<p>
			<label for="mobile">
				<span class="label">Mobile #:</span>
				<input type="tel" size="20" class="sig-input" name="mobile" value="" maxlength="10" placeholder="6045550199">
			</label>
		</p>
		<p>
			<label for="email">
				<span class="label">Email:</span>
				<input type="email" size="40" class="sig-input" name="email" value="" placeholder="michael.ellis@enernoc.com">
			</label>
		</p>
	</fieldset>

	<h3>Preview:</h3>

	<div class="sig-preview">
		<div style="font-family: arial, sans-serif; font-size: 13px; line-height: 1.3; color: #999999; padding-top: 20px;"><strong style="color: #003e74;">Michael Ellis</strong> / <span style="color: #003e74;">Widget Supervisor</span></div>
		<div style="font-family: arial, sans-serif; font-size: 12px; line-height: 1.3; color: #999999;">EnerNOC, Inc. / 576 Seymour Street, Suite 600, Vancouver, BC V6B 3K1</div>
		<div style="font-family: arial, sans-serif; font-size: 12px; line-height: 1.3; color: #999999;">t: <a href="tel:%2B1%20%28778%29%20331%200500" value="+17783310500" style="color: #999999; font-family: arial, sans-serif; text-decoration: none;">+1 (778) 331 0500</a> / m: <a href="tel:%2B1%20%28604%29%20555%200199" value="+16045550199" style="color: #999999; font-family: arial, sans-serif; text-decoration: none;">+1 (604) 555 0199</a> / <a href="mailto:bob.loblaw@enernoc.com" style="color: #003e74; text-decoration: none;">michael.ellis@enernoc.com</a></div>
		<div style="font-family: arial, sans-serif; font-size: 12px; line-height: 1.3; color: #999999;"><a href="http://www.enernoc.com" style="color: #003e74; text-decoration: none;">www.enernoc.com</a> / <a href="http://energysmart.enernoc.com" style="color: #003e74; text-decoration: none;">energysmart.enernoc.com</a></div>
	</div>

	<button id="sig-preview-button">Copy signature to clipboard</button>

	<h3>HTML:</h3>

	<div class="sig-source-wrapper">
		<textarea cols="60" rows="4" class="sig-source" spellcheck="false"></textarea>
		<button id="sig-copy-button">Copy HTML to clipboard</button>
	</div>

</body>
</html>
